---
description: 项目通用规则
globs:
alwaysApply: true
---

# 项目通用规则

- 始终使用中文回复用户，但技术专有名词可保留英文（如 API、Python、DTO等）。
- 使用项目既有风格，不引入新风格，包括代码、文档或交互，默认延用项目中已有的格式、缩进、命名习惯。
- 尽可能少地输出内容，仅提供高信息密度回复，禁止无效寒暄、过度铺垫，只输出对当前任务有直接帮助的信息。

# 数据库SQL
- 使用 INSERT OR REPLACE INTO 插入数据
- 尽量使用 sqlalchemy 和 pd.read_sql查询数据并返回df.to_dict('records')
- 使用:占位符 cursor.execute("SELECT * FROM tasks WHERE task_id=:task_id", {"task_id": task_id})


# 后端开发规范:
    1. 数据库操作维护在DBService中，其他地方不要进行数据库操作。
    2. 数据库操作维护在DBService中，其他地方不要进行数据库操作。
    3. run_task_api维护在对应Service中。
    4. 默认不生成测试文件。
    5. @handle_errors 装饰器放在最后，避免swagger失效
    6. 数据库表的_info字段，存储格式为json，请使用json.dumps()转换。
    7. 异步任务：
       7.1 使用start_xx_task方法启动
       7.2 使用stop_xx_task方法停止
       7.3 使用DBService.get_task_info方法获取任务信息
       7.4 使用DBService.update_task_info方法更新任务信息
       7.5 使用DBService.delete_task_info方法删除任务信息
       7.6 使用DBService.create_xx_task方法创建任务
    11. 必须使用Python的unittest框架进行测试。
    12. 测试文件必须以Tests.py结尾，例如：DataUtilTests.py, ModelTests.py
    13. 测试方法名必须以test_开头，例如：test_format_float, test_split_dataset
    14. 测试类和方法必须包含文档字符串，说明测试目的
    15. 使用common.logging_config.logger记录日志。
    16. 所有函数包括xx_id的，如task_id和dataset_id，可传入参数进行指定，未传入则使用uuid。
    # 视频文件处理
    -- 使用*'avc1'写入视频文件，保证浏览器可以直接运行。
